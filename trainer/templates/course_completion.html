{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h3 class="mb-4">Course Completion Tracker</h3>

    <!-- Optional: Filter by Course -->
    <form method="get" class="mb-3">
        <div class="row">
            <div class="col-md-4">
                <select class="form-select" name="course_id" onchange="this.form.submit()">
                    <option value="">-- Filter by Course --</option>
                    {% for course in courses %}
                        <option value="{{ course.course_id }}" {% if request.args.get('course_id')|int == course.course_id %}selected{% endif %}>
                            {{ course.course_name }}
                        </option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </form>

    <table class="table table-bordered table-hover">
        <thead class="table-dark">
            <tr>
                <th>Student</th>
                <th>Topics Completed</th>
                <th>Assignments Completed</th>
                <th>Completion %</th>
                <th>Status</th>
                <th>Remarks</th>
            </tr>
        </thead>
        <tbody>
        {% if progress_list %}
            {% for row in progress_list %}
                {% set row_class = '' %}
                {% if row.status != 'Completed' and row.completion_percentage < 50 %}
                    {% set row_class = 'table-danger' %}
                {% elif row.status != 'Completed' and row.completion_percentage >= 50 %}
                    {% set row_class = 'table-warning' %}
                {% endif %}
                <tr class="{{ row_class }}">
                    <td>{{ row.student_name }}</td>
                    <td>{{ row.topics_completed or 0 }}/{{ row.total_topics or 0 }}</td>
                    <td>{{ row.assignments_completed or 0 }}/{{ row.total_assignments or 0 }}</td>
                    <td>
                        <div class="progress" style="height: 25px;">
                            <div class="progress-bar {% if row.completion_percentage < 50 %}bg-danger{% elif row.completion_percentage < 100 %}bg-warning{% else %}bg-success{% endif %}" 
                                 role="progressbar" 
                                 style="width:' {{ row.completion_percentage or 0 }}%';" 
                                 aria-valuenow="{{ row.completion_percentage or 0 }}" 
                                 aria-valuemin="0" aria-valuemax="100">
                                 {{ row.completion_percentage or 0 }}%
                            </div>
                        </div>
                    </td>
                    <td>{{ row.status or 'Not Started' }}</td>
                    <td>{{ row.remarks or '-' }}</td>
                </tr>
            {% endfor %}
        {% else %}
            <tr>
                <td colspan="6" class="text-center">No student progress found for this batch.</td>
            </tr>
        {% endif %}
        </tbody>
    </table>

    <!-- Optional: Legend -->
    <div class="mt-3">
        <span class="badge bg-success">Completed</span>
        <span class="badge bg-warning">In Progress</span>
        <span class="badge bg-danger">Low Progress</span>
    </div>
</div>
{% endblock %}
